#!/bin/bash
# Commit message validation hook
# Validates commit message format according to CLAUDE.md rules

set -e

# Colours for output
RED='\033[0;31m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Colour

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Check for Claude Code attribution (should be omitted per CLAUDE.md)
if echo "$COMMIT_MSG" | grep -qi "Generated with.*Claude Code\|Co-Authored-By:.*Claude"; then
    echo -e "${RED}âœ— Commit message validation failed${NC}"
    echo ""
    echo "Your commit message contains Claude attribution."
    echo "According to CLAUDE.md, this should be omitted:"
    echo ""
    echo "  ## Git Commit Messages"
    echo "  - Use conventional commits (feat:, fix:, docs:, etc.)"
    echo -e "  - ${YELLOW}Omit Claude Code attribution footer${NC}"
    echo "  - Keep first line under 50 chars"
    echo ""
    echo "Please remove the attribution and try again."
    exit 1
fi

exit 0
